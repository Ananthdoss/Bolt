<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3"/>
<title>Bolt: Building TBB (Intel) with Bolt</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bolt
   &#160;<span id="projectnumber">1.2</span>
   </div>
   <div id="projectbrief">C++ template library with support for OpenCL</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Building TBB (Intel) with Bolt </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#tbb">TBB (Intel)</a><ul><li class="level2"><a href="#install">Setting up TBB (Intel) with Bolt.</a></li>
<li class="level2"><a href="#bolt_tbb">TBB (Intel) routines in Bolt</a></li>
</ul>
</li>
<li class="level1"><a href="#using_tbb">Running TBB (Intel) routines in Bolt</a><ul><li class="level2"><a href="#tbb_control">Control object</a></li>
<li class="level2"><a href="#examples">Examples:</a><ul><li class="level3"><a href="#transform_reduce">Transform Reduce:</a></li>
<li class="level3"><a href="#scan_by_key">Inclusive and Exclusive Scan By key:</a></li>
<li class="level3"><a href="#sort">Sort:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="tbb"></a>
TBB (Intel)</h1>
<p>Intel Threading Building Blocks (also known as TBB (Intel)) is library developed by Intel Corporation for writing software programs that take advantage of multi-core processors. The library consists of data structures and algorithms that allow a programmer to avoid some complications arising from the use of native threading packages such as POSIX threads, Windows &reg; threads, or the portable Boost Threads in which individual threads of execution are created, synchronized, and terminated manually.</p>
<p>BOLT supports parallelization using Intel Threading Building Blocks (TBB (Intel)). You can switch between CL/AMP and TBB (Intel) calls by changing the control structure.</p>
<h2><a class="anchor" id="install"></a>
Setting up TBB (Intel) with Bolt.</h2>
<p>To start using high performance MultiCore routines with Bolt. Install TBB (Intel) from <a href="http://threadingbuildingblocks.org/download">here </a> On Windows &reg;, add TBB_ROOT to your environment variable list. e.g. <code>TBB_ROOT=&lt;path-to-tbb-root&gt;</code>. Run the batch file <code>tbbvars.bat</code> (e.g. <code>tbbvars.bat</code> intel64 vs2012) which is in <code>TBB_ROOT%\bin\directory</code>. This batch file takes 2 arguments. &lt;arch&gt; = [32|64] and &lt;vs&gt; - version of Visual Studio. If you want to set it globally then append the TBB (Intel) dll path e.g. <code>TBB_ROOT%</code> \intel64\vc11 in “PATH” Environment variable. This will set all the paths required for TBB (Intel).</p>
<p><b> NOTE: </b> On <b> Linux &reg;</b>, set the <b> TBB_ROOT </b>, <b> PATH </b> and <b> LD_LIBRARY_PATH </b> variables. <br/>
 E.g. <code> 'export TBB_ROOT=&lt;path-to-tbb-root&gt;' </code> <br/>
 <code> 'export LD_LIBRARY_PATH = &lt;path-to-tbb-root&gt;/lib/intel64/gcc-4.4:$LD_LIBRARY_PATH' </code> <br/>
 <code> 'export PATH = &lt;path-to-tbb-root&gt;/include:$PATH' </code></p>
<p>Then install CMake (see <a class="el" href="buildingBolt.html#cmake">Using CMake build infrastructure</a>). To enable TBB (Intel), BUILD_TBB check box should be checked in CMake configuration list as shown below, the build procedure is as usual. </p>
<div class="image">
<img src="cmake.build.first.tbb.png" alt="cmake.build.first.tbb.png"/>
<div class="caption">
Check BUILD_TBB</div></div>
<p>On successful build, the TBB (Intel) paths are shown in the Visual Studio Output tab as shown below. </p>
<div class="image">
<img src="bolt.visual.studio.build.tbb.png" alt="bolt.visual.studio.build.tbb.png"/>
<div class="caption">
TBB_VS_Build</div></div>
 <h2><a class="anchor" id="bolt_tbb"></a>
TBB (Intel) routines in Bolt</h2>
<p>These are the Bolt routines with TBB (Intel) support for MultiCore path enlisted along with the backend:</p>
<ul>
<li>Copy - OpenCL</li>
<li>Copy_n - OpenCL</li>
<li>Count - OpenCL/AMP</li>
<li>Count_if - OpenCL/AMP</li>
<li>Exclusive_Scan - OpenCL/AMP</li>
<li>Exclusive_Scan_by_key - OpenCL</li>
<li>Fill - OpenCL</li>
<li>Fill_n - OpenCL</li>
<li>Generate - OpenCL</li>
<li>Generate_n - OpenCL</li>
<li>Inclusive_Scan - OpenCL/AMP</li>
<li>Inclusive_Scan_by_key - OpenCL</li>
<li>Inner_Product - OpenCL</li>
<li>Max_Element - OpenCL</li>
<li>Min_Element - OpenCL</li>
<li>Reduce - OpenCL/AMP</li>
<li>Reduce_By_Key - OpenCL</li>
<li>Sort - OpenCL/AMP</li>
<li>Sort_By_Key - OpenCL</li>
<li>Stable_Sort - OpenCL/AMP</li>
<li>StableSort_By_Key - OpenCL</li>
<li>Transform - OpenCL/AMP</li>
<li>Transform_Exclusive_Scan - OpenCL</li>
<li>Transform_Inclusive_Scan - OpenCL</li>
<li>Transform_Reduce - OpenCL/AMP</li>
<li>Binary_Search - OpenCL</li>
<li>Merge - OpenCL</li>
<li>Scatter - OpenCL</li>
<li>Scatter_if - OpenCL</li>
<li>Gather - OpenCL</li>
<li>Gather_if - OpenCL</li>
</ul>
<h1><a class="anchor" id="using_tbb"></a>
Running TBB (Intel) routines in Bolt</h1>
<h2><a class="anchor" id="tbb_control"></a>
Control object</h2>
<p>Bolt function can be forced to run on the specified device. Default is "Automatic" in which case the Bolt runtime selects the device. Forcing the mode to MulticoreCpu will run the function on all cores detected. There are two ways in BOLT to force the control to MulticoreCPU.</p>
<ol type="1">
<li><b> Setting control to MulticoreCPU Globally: </b> <div class="fragment"><div class="line"><a class="code" href="classbolt_1_1cl_1_1control.html">bolt::cl::control</a>&amp; myControl = <a class="code" href="group__CL-control.html#ga59712ff5a77d3714f716d85938705289">bolt::cl::control::getDefault</a>( );</div>
<div class="line">myControl.waitMode( bolt::cl::control::NiceWait );</div>
<div class="line">myControl.<a class="code" href="group__CL-control.html#gab2ae4ea074dd26814f6356d884cc2146">setForceRunMode</a>( bolt::cl::control::MultiCoreCpu );</div>
</div><!-- fragment --> This will set the control to MultiCore CPU globally, So reference to any BOLT function will always run MultiCore CPU path.</li>
<li><b> Setting control to MuticoreCPU locally </b> <div class="fragment"><div class="line"><a class="code" href="classbolt_1_1cl_1_1control.html">bolt::cl::control</a> myControl = <a class="code" href="group__CL-control.html#ga59712ff5a77d3714f716d85938705289">bolt::cl::control::getDefault</a>( );</div>
<div class="line">myControl.<a class="code" href="group__CL-control.html#gab2ae4ea074dd26814f6356d884cc2146">setForceRunMode</a>(bolt::cl::control::MultiCoreCpu);</div>
</div><!-- fragment --> This will set the control to MultiCore CPU locally, passing this control object as first parameter to BOLT function enables multicore path only for the calling function.</li>
</ol>
<p>AMP has same use case only CL namespace(bolt::cl) needs to be change to AMP(bolt::amp)</p>
<p><b>Other Scenarios: </b></p>
<ol type="1">
<li>Using MulticoreCPU flag with BOLT function, when TBB (Intel) is not installed on the machine will throw an exception like "The MultiCoreCpu version of &lt;function&gt; is not enabled to be built." Proper care has to be taken to make sure that TBB (Intel) is installed in the system.</li>
<li>The default mode is "Automatic" which means it will go into OpenCL &trade; path first, then TBB (Intel), then SerialCpu. The examples discussed below in the next subsection focus on how TBB (Intel) parallelization is achieved with different functions.</li>
</ol>
<h2><a class="anchor" id="examples"></a>
Examples:</h2>
<h3><a class="anchor" id="transform_reduce"></a>
Transform Reduce:</h3>
<p>Transform_reduce performs a transformation defined by unary_op into a temporary sequence and then performs reduce on the transformed sequence.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cl_2control_8h.html" title="Control the parameters of a specific Bolt algorithm call.">bolt/cl/control.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cl_2transform__reduce_8h.html" title="Fuses transform and reduce operations together.">bolt/cl/transform_reduce.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line">.....</div>
<div class="line"></div>
<div class="line">int length = 10;</div>
<div class="line">std::vector&lt; float &gt; input( length );</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classbolt_1_1cl_1_1control.html">bolt::cl::control</a> ctl = <a class="code" href="group__CL-control.html#ga59712ff5a77d3714f716d85938705289">bolt::cl::control::getDefault</a>( );</div>
<div class="line">ctl.<a class="code" href="group__CL-control.html#gab2ae4ea074dd26814f6356d884cc2146">setForceRunMode</a>(bolt::cl::control::MultiCoreCpu);</div>
<div class="line"> </div>
<div class="line">bolt::cl::negate&lt;float&gt; unary_op;</div>
<div class="line">bolt::cl::plus&lt;float&gt; binary_op;</div>
<div class="line"><span class="keywordtype">float</span> boldReduce = <a class="code" href="group__CL-transform__reduce.html#gae58c061918f2819ad9df48a133c63f89" title="transform_reduce fuses transform and reduce operations together, increasing performance by reducing m...">bolt::cl::transform_reduce</a>(ctl, input.begin(), input.end(), unary_op, 4.f, binary_op );</div>
</div><!-- fragment --><p>AMP backend variant: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="amp_2control_8h.html" title="Control the parameters of a specific Bolt algorithm call.">bolt/amp/control.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="amp_2transform__reduce_8h.html" title="Fuses transform and reduce operations together.">bolt/amp/transform_reduce.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line">...</div>
<div class="line">int length = 10;</div>
<div class="line">std::vector&lt; float &gt; input( length );</div>
<div class="line"></div>
<div class="line"><a class="code" href="classbolt_1_1amp_1_1control.html">bolt::amp::control</a> ctl = <a class="code" href="group__AMP-control.html#gaffa8e713ecb8bd1ee469c3565e046a62">bolt::amp::control::getDefault</a>( );</div>
<div class="line">ctl.<a class="code" href="group__AMP-control.html#ga3e51894078b4d33db3aa97fc30ac24b4">setForceRunMode</a>(bolt::amp::control::MultiCoreCpu);</div>
<div class="line"><span class="keywordtype">float</span> boldReduce = <a class="code" href="group__CL-transform__reduce.html#gae58c061918f2819ad9df48a133c63f89" title="transform_reduce fuses transform and reduce operations together, increasing performance by reducing m...">bolt::cl::transform_reduce</a>(ctl, input.begin(), input.end(),  unary_op, 4.f, binary_op );</div>
</div><!-- fragment --><h3><a class="anchor" id="scan_by_key"></a>
Inclusive and Exclusive Scan By key:</h3>
<p>Inclusive_scan_by_key performs, on a sequence, an inclusive scan of each sub-sequence as defined by equivalent keys.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cl_2control_8h.html" title="Control the parameters of a specific Bolt algorithm call.">bolt/cl/control.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cl_2scan__by__key_8h.html" title="Performs, on a sequence, scan of each sub-sequence as defined by equivalent keys inclusive or exclusi...">bolt/cl/scan_by_key.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line">......</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> length = 10;</div>
<div class="line">std::vector&lt; int &gt; keys = {1, 2, 2, 3, 3, 3, 4, 4, 4, 4};</div>
<div class="line"><span class="comment">// input and output vectors for device and reference</span></div>
<div class="line">std::vector&lt; float &gt; input( length);</div>
<div class="line">std::vector&lt; float &gt; output( length);</div>
<div class="line"> </div>
<div class="line">bolt::cl::equal_to&lt;int&gt; eq; </div>
<div class="line">bolt::cl::plus&lt;float&gt; plus; </div>
<div class="line"> </div>
<div class="line"><a class="code" href="classbolt_1_1cl_1_1control.html">bolt::cl::control</a> ctl = <a class="code" href="group__CL-control.html#ga59712ff5a77d3714f716d85938705289">bolt::cl::control::getDefault</a>( );</div>
<div class="line">ctl.<a class="code" href="group__CL-control.html#gab2ae4ea074dd26814f6356d884cc2146">setForceRunMode</a>(bolt::cl::control::MultiCoreCpu); </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Inclusive call:</span></div>
<div class="line"><a class="code" href="group__CLSegmentedPrefixSums.html#gab9269ad1d61edb2ffb20ebee6e12bcb6" title="inclusive_scan_by_key performs, on a sequence, an inclusive scan of each sub-sequence as defined by e...">bolt::cl::inclusive_scan_by_key</a>(ctl, keys.begin(), keys.end(), input.begin(), output.begin(), eq, plus);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Exclusive call:</span></div>
<div class="line"><a class="code" href="group__CLSegmentedPrefixSums.html#ga802f9694048d41d2cd4c960659d61abf" title="exclusive_scan_by_key performs, on a sequence, an exclusive scan of each sub-sequence as defined by e...">bolt::cl::exclusive_scan_by_key</a>(ctl, keys.begin(), keys.end(), input.begin(), output.begin(), 4.0f, eq, plus)</div>
</div><!-- fragment --><p> AMP backend variant: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="amp_2control_8h.html" title="Control the parameters of a specific Bolt algorithm call.">bolt/amp/control.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="amp_2scan__by__key_8h.html" title="Performs, on a sequence, scan of each sub-sequence as defined by equivalent keys inclusive or exclusi...">bolt/amp/scan_by_key.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line">......</div>
<div class="line"></div>
<div class="line"><a class="code" href="classbolt_1_1amp_1_1control.html">bolt::amp::control</a> ctl = <a class="code" href="group__AMP-control.html#gaffa8e713ecb8bd1ee469c3565e046a62">bolt::amp::control::getDefault</a>( );</div>
<div class="line">ctl.<a class="code" href="group__AMP-control.html#ga3e51894078b4d33db3aa97fc30ac24b4">setForceRunMode</a>(bolt::amp::control::MultiCoreCpu);</div>
<div class="line"></div>
<div class="line">std::vector&lt; float &gt; input( length);</div>
<div class="line">std::vector&lt; float &gt; output( length);</div>
<div class="line"> </div>
<div class="line">bolt::cl::equal_to&lt;int&gt; eq; </div>
<div class="line">bolt::cl::plus&lt;float&gt; plus; </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Inclusive call:</span></div>
<div class="line"><a class="code" href="group__AMPSegmentedPrefixSums.html#gae514c0b964fc5183045f0dec3f7282c4" title="inclusive_scan_by_key performs, on a sequence, an inclusive scan of each sub-sequence as defined by e...">bolt::amp::inclusive_scan_by_key</a>(ctl, keys.begin(), keys.end(), input.begin(), output.begin(), eq, plus);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Exclusive call:</span></div>
<div class="line"><a class="code" href="group__AMPSegmentedPrefixSums.html#gae514c0b964fc5183045f0dec3f7282c4" title="inclusive_scan_by_key performs, on a sequence, an inclusive scan of each sub-sequence as defined by e...">bolt::amp::inclusive_scan_by_key</a>(ctl, keys.begin(), keys.end(), input.begin(), output.begin(), 4.0f, eq, plus);</div>
</div><!-- fragment --><h3><a class="anchor" id="sort"></a>
Sort:</h3>
<p>Sort the input array based on the comparison function provided.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cl_2control_8h.html" title="Control the parameters of a specific Bolt algorithm call.">bolt/cl/control.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cl_2sort_8h.html" title="Returns the sorted result of all the elements in input.">bolt/cl/sort.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line">.....</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> length = 1024;</div>
<div class="line">std::vector&lt; float &gt; input( length, 0.0 );</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classbolt_1_1cl_1_1control.html">bolt::cl::control</a> ctl = <a class="code" href="group__CL-control.html#ga59712ff5a77d3714f716d85938705289">bolt::cl::control::getDefault</a>( );</div>
<div class="line">ctl.<a class="code" href="group__CL-control.html#gab2ae4ea074dd26814f6356d884cc2146">setForceRunMode</a>(bolt::cl::control::MultiCoreCpu);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__CL-sort.html#ga7720660d4a8dee06ea5314d3a1db7db3" title="This version of sort returns the sorted result of all the elements in the RandomAccessIterator betwee...">bolt::cl::sort</a>( ctl, boltInput.begin( ), boltInput.end( ), cmp_fun );</div>
</div><!-- fragment --><p>AMP backend variant: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="amp_2control_8h.html" title="Control the parameters of a specific Bolt algorithm call.">bolt/amp/control.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="amp_2sort_8h.html" title="Returns the sorted result of all the elements in input.">bolt/amp/sort.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line">....</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> length = 1024;</div>
<div class="line">std::vector&lt; float &gt; input( length, 0.0 );</div>
<div class="line"></div>
<div class="line"><a class="code" href="classbolt_1_1amp_1_1control.html">bolt::amp::control</a> ctl = <a class="code" href="group__AMP-control.html#gaffa8e713ecb8bd1ee469c3565e046a62">bolt::amp::control::getDefault</a>( );</div>
<div class="line">ctl.<a class="code" href="group__AMP-control.html#ga3e51894078b4d33db3aa97fc30ac24b4">setForceRunMode</a>(bolt::amp::control::MultiCoreCpu);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__CL-sort.html#ga7720660d4a8dee06ea5314d3a1db7db3" title="This version of sort returns the sorted result of all the elements in the RandomAccessIterator betwee...">bolt::cl::sort</a>( ctl, boltInput.begin( ), boltInput.end( ), cmp_fun );</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jul 2 2014 12:04:31 for Bolt by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3
</small></address>
</body>
</html>
